#!/usr/local/bin/php
<?php

declare(strict_types=1);

if (php_sapi_name() !== 'cli') {
    exit;
}

//require __DIR__ . '/../vendor/autoload.php';

use Dominion\Cards\Cards;
use Dominion\Kingdom\Kingdom;
use Minicli\App;
use Minicli\Command\CommandCall;
use Minicli\Exception\CommandNotFoundException;

require_once __DIR__ . '/../bootstrap/init.php';
$db = require_once __DIR__ . '/../bootstrap/db.php';

$app = new App();
$app->setSignature('./minicli mycommand');

$app->registerCommand('mycommand', function(CommandCall $input) {
    echo 'My Command!';

    var_dump($input);
});

$app->registerCommand('build', function(CommandCall $input) {
    $cards = new Cards($db);
    $kingdom = new Kingdom($db, $cards);

    $generated = $kingdom->buildKingdom(20)
                         ->getKingdomListWithDetails();
});


try {
    $app->runCommand($argv);
} catch (CommandNotFoundException $e) {
    echo 'An error occurred running the command: ',  $e->getMessage(), "\n";
} catch (Throwable $e) {
    echo 'Another error occurred running the command: ',  $e->getMessage(), "\n";
}
